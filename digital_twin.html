<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O-RAN Fronthaul Digital Twin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="digital_twin.css">
</head>

<body>
    <!-- Background Grid -->
    <div class="noc-grid"></div>

    <!-- Main Container -->
    <div class="twin-container">

        <!-- Header: Digital Twin Status -->
        <header class="twin-header">
            <div class="header-left">
                <h1 class="twin-title">O-RAN Fronthaul Digital Twin</h1>
                <p class="twin-subtitle">Deterministic Network Simulator ¬∑ Symbol-Level Replay</p>
            </div>
            <div class="header-right">
                <div class="mode-toggle">
                    <button class="mode-btn active" data-mode="replay">
                        <span class="icon">‚èØ</span> Replay
                    </button>
                    <button class="mode-btn" data-mode="live">
                        <span class="icon">‚¨§</span> Live
                    </button>
                </div>
                <div class="intelligence-toggle">
                    <span class="toggle-label">Intelligence:</span>
                    <button class="intel-btn" data-state="off">
                        <span class="state-indicator"></span>
                        <span class="state-text">OFF</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Topology Discovery Panel (Resigned for Causal Explanation) -->
        <section class="topology-panel">
            <div class="panel-header">
                <h2>1. Topology Discovery</h2>
                <div class="stage-indicators">
                    <div class="stage-indicator active" id="stageA">
                        <span class="stage-step">A</span>
                        <span class="stage-name">Observation</span>
                    </div>
                    <div class="stage-arrow">‚Üí</div>
                    <div class="stage-indicator" id="stageB">
                        <span class="stage-step">B</span>
                        <span class="stage-name">Correlation</span>
                    </div>
                    <div class="stage-arrow">‚Üí</div>
                    <div class="stage-indicator" id="stageC">
                        <span class="stage-step">C</span>
                        <span class="stage-name">Inference</span>
                    </div>
                </div>
            </div>

            <div class="topology-stage-container">
                <!-- STAGE A: Observation (Loss Timelines) -->
                <div class="topo-stage" id="topologyStageA">
                    <div class="stage-description">
                        <span class="icon">üëÄ</span>
                        <p>Observing packet loss events per cell over time...</p>
                    </div>
                    <div class="loss-timelines-container" id="lossTimelines">
                        <!-- Timelines generated by JS -->
                    </div>
                </div>

                <!-- STAGE B: Correlation (Force Graph) -->
                <div class="topo-stage hidden" id="topologyStageB">
                    <div class="stage-description">
                        <span class="icon">üîó</span>
                        <p> detecting synchronized loss patterns...</p>
                    </div>
                    <canvas id="correlationCanvas" width="1200" height="400"></canvas>
                </div>

                <!-- STAGE C: Inference (Final Topo) -->
                <div class="topo-stage hidden" id="topologyStageC">
                    <div class="stage-description">
                        <span class="icon">‚ú®</span>
                        <p>Shared fronthaul topology inferred with <strong id="confidenceScore">0%</strong> confidence.
                        </p>
                    </div>
                    <canvas id="inferenceCanvas" width="1200" height="400"></canvas>
                </div>
            </div>

            <div class="topology-controls">
                <button class="topo-btn" id="nextStageBtn">
                    <span class="icon">‚ñ∂</span> Next Stage
                </button>
                <button class="topo-btn secondary" id="resetTopologyBtn">
                    <span class="icon">‚Ü∫</span> Reset
                </button>
            </div>
        </section>

        <!-- Before vs After Comparison -->
        <section class="comparison-panel">
            <div class="panel-header">
                <h2>Before vs After: Digital Twin Proof</h2>
            </div>
            <div class="comparison-container">
                <!-- Baseline (Left) -->
                <div class="comparison-side baseline">
                    <div class="side-header">
                        <span class="status-icon">‚ùå</span>
                        <h3>WITHOUT TWIN</h3>
                        <span class="side-label">Baseline</span>
                    </div>
                    <div class="traffic-viz" id="baselineViz">
                        <canvas id="baselineCanvas" width="550" height="300"></canvas>
                        <div class="viz-overlay">
                            <div class="capacity-line">
                                <span class="capacity-label">Capacity Limit</span>
                            </div>
                            <div class="loss-indicators" id="baselineLossIndicators"></div>
                        </div>
                    </div>
                    <div class="side-footer">
                        <div class="metric">
                            <span class="metric-label">Peak Rate:</span>
                            <span class="metric-value" id="baselinePeak">--</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Packet Loss:</span>
                            <span class="metric-value loss" id="baselineLoss">--</span>
                        </div>
                        <div class="side-description">Peak-driven dimensioning</div>
                    </div>
                </div>

                <!-- Divider -->
                <div class="comparison-divider">
                    <div class="divider-line"></div>
                    <div class="divider-icon">‚ö°</div>
                    <div class="divider-label">Time-Domain Shaping</div>
                </div>

                <!-- Optimized (Right) -->
                <div class="comparison-side optimized">
                    <div class="side-header">
                        <span class="status-icon">‚úÖ</span>
                        <h3>WITH TWIN</h3>
                        <span class="side-label">Optimized</span>
                    </div>
                    <div class="traffic-viz" id="optimizedViz">
                        <canvas id="optimizedCanvas" width="550" height="300"></canvas>
                        <div class="viz-overlay">
                            <div class="capacity-line optimized">
                                <span class="capacity-label">Reduced Capacity</span>
                            </div>
                            <div class="buffer-indicator">
                                <span class="buffer-label">Buffer Absorbing</span>
                            </div>
                        </div>
                    </div>
                    <div class="side-footer">
                        <div class="metric">
                            <span class="metric-label">Shaped Rate:</span>
                            <span class="metric-value" id="optimizedPeak">--</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Packet Loss:</span>
                            <span class="metric-value success" id="optimizedLoss">0.00%</span>
                        </div>
                        <div class="side-description">Time-domain shaping enabled</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Link Physics Visualization -->
        <section class="physics-panel">
            <div class="panel-header">
                <h2>Link Physics: Real-Time Buffer Dynamics</h2>
                <div class="link-selector">
                    <label for="linkSelect">Select Link:</label>
                    <select id="linkSelect">
                        <option value="">Loading...</option>
                    </select>
                </div>
            </div>
            <div class="physics-container">
                <!-- Capacity Meter -->
                <div class="physics-widget capacity-widget">
                    <h3>Capacity Utilization</h3>
                    <div class="capacity-meter">
                        <div class="meter-bar">
                            <div class="meter-fill" id="capacityFill" style="width: 0%"></div>
                            <div class="meter-threshold"></div>
                        </div>
                        <div class="meter-labels">
                            <span class="meter-label">0 Gbps</span>
                            <span class="meter-label" id="capacityValue">0.0 Gbps</span>
                            <span class="meter-label" id="capacityMax">-- Gbps</span>
                        </div>
                    </div>
                </div>

                <!-- Buffer Visualization -->
                <div class="physics-widget buffer-widget">
                    <h3>Buffer Occupancy</h3>
                    <div class="buffer-container">
                        <div class="buffer-tank">
                            <div class="buffer-fill" id="bufferFill" style="height: 0%"></div>
                            <div class="buffer-overflow-line"></div>
                        </div>
                        <div class="buffer-stats">
                            <div class="buffer-stat">
                                <span class="stat-label">Occupancy:</span>
                                <span class="stat-value" id="bufferOccupancy">0%</span>
                            </div>
                            <div class="buffer-stat">
                                <span class="stat-label">Depth:</span>
                                <span class="stat-value" id="bufferDepth">-- ¬µs</span>
                            </div>
                            <div class="buffer-stat">
                                <span class="stat-label">Status:</span>
                                <span class="stat-value" id="bufferStatus">IDLE</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Packet Loss Counter -->
                <div class="physics-widget loss-widget">
                    <h3>Packet Loss Events</h3>
                    <div class="loss-counter">
                        <div class="loss-value" id="lossCounter">0</div>
                        <div class="loss-label">Total Events</div>
                    </div>
                    <div class="loss-percentage">
                        <span class="loss-pct-value" id="lossPct">0.000%</span>
                        <span class="loss-pct-label">Loss Rate</span>
                    </div>
                </div>

                <!-- Traffic Rate Trace -->
                <div class="physics-widget trace-widget">
                    <h3>Incoming Rate Trace</h3>
                    <canvas id="rateTraceCanvas" width="300" height="150"></canvas>
                    <div class="trace-stats">
                        <span class="trace-stat">Peak: <strong id="tracePeak">--</strong></span>
                        <span class="trace-stat">Avg: <strong id="traceAvg">--</strong></span>
                        <span class="trace-stat">PAPR: <strong id="tracePAPR">--</strong></span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Time Control -->
        <section class="time-control-panel">
            <div class="time-header">
                <h2>Time Control: Slot-Based Replay</h2>
                <div class="slot-info">
                    <span class="slot-label">Current Slot:</span>
                    <span class="slot-value" id="currentSlot">0</span>
                    <span class="slot-separator">/</span>
                    <span class="slot-total" id="totalSlots">0</span>
                    <span class="time-hint">(1 slot ‚âà 500 ¬µs)</span>
                </div>
            </div>
            <div class="time-controls">
                <button class="time-btn" id="rewindBtn" title="Rewind">
                    <span class="icon">|‚óÑ‚óÑ</span>
                </button>
                <button class="time-btn" id="prevBtn" title="Previous Slot">
                    <span class="icon">‚óÑ</span>
                </button>
                <button class="time-btn primary" id="playPauseBtn" title="Play/Pause">
                    <span class="icon">‚ñ∂</span>
                </button>
                <button class="time-btn" id="nextBtn" title="Next Slot">
                    <span class="icon">‚ñ∫</span>
                </button>
                <button class="time-btn" id="fastForwardBtn" title="Fast Forward">
                    <span class="icon">‚ñ∫‚ñ∫|</span>
                </button>
                <div class="playback-speed">
                    <label for="speedSelect">Speed:</label>
                    <select id="speedSelect">
                        <option value="0.5">0.5x</option>
                        <option value="1" selected>1x</option>
                        <option value="2">2x</option>
                        <option value="5">5x</option>
                        <option value="10">10x</option>
                    </select>
                </div>
            </div>
            <div class="timeline-container">
                <div class="timeline" id="timeline">
                    <div class="timeline-track">
                        <div class="timeline-progress" id="timelineProgress" style="width: 0%"></div>
                        <div class="timeline-handle" id="timelineHandle" style="left: 0%"></div>
                        <div class="loss-event-markers" id="lossEventMarkers"></div>
                    </div>
                </div>
                <div class="timeline-tooltip" id="timelineTooltip">
                    Slot: <span id="tooltipSlot">0</span>
                </div>
            </div>
            <div class="jump-controls">
                <button class="jump-btn" id="jumpToStartBtn">
                    <span class="icon">‚èÆ</span> Jump to Start
                </button>
                <button class="jump-btn" id="jumpToLossBtn">
                    <span class="icon">‚ö†</span> Jump to Next Loss Event
                </button>
                <button class="jump-btn" id="jumpToEndBtn">
                    <span class="icon">‚è≠</span> Jump to End
                </button>
            </div>
        </section>

        <!-- Operator Decision Panel -->
        <section class="decision-panel">
            <div class="panel-header">
                <h2>Operator Decision Engine</h2>
                <div class="decision-status">
                    <span class="status-label">System Status:</span>
                    <span class="status-badge" id="systemStatus">ANALYZING</span>
                </div>
            </div>
            <div class="decision-container">
                <!-- Risk Assessment -->
                <div class="decision-widget risk-widget">
                    <h3>Current Risk Level</h3>
                    <div class="risk-indicator">
                        <div class="risk-level" id="riskLevel">NONE</div>
                        <div class="risk-bar">
                            <div class="risk-fill" id="riskFill" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="risk-metrics">
                        <div class="risk-metric">
                            <span class="metric-label">Loss Percentage:</span>
                            <span class="metric-value" id="riskLossPct">0.00%</span>
                        </div>
                        <div class="risk-metric">
                            <span class="metric-label">Confidence:</span>
                            <span class="metric-value" id="riskConfidence">--</span>
                        </div>
                    </div>
                </div>

                <!-- Recommendation -->
                <div class="decision-widget recommendation-widget">
                    <h3>Recommendation</h3>
                    <div class="recommendation-box" id="recommendationBox">
                        <div class="recommendation-icon" id="recommendationIcon">‚úÖ</div>
                        <div class="recommendation-text" id="recommendationText">
                            Analyzing network state...
                        </div>
                    </div>
                    <div class="recommendation-rationale">
                        <h4>Rationale:</h4>
                        <p id="rationaleText">System is performing initial analysis of network telemetry and topology
                            discovery.</p>
                    </div>
                </div>

                <!-- Action Summary -->
                <div class="decision-widget action-widget">
                    <h3>Deployment Summary</h3>
                    <div class="action-stats">
                        <div class="action-stat success">
                            <div class="stat-value" id="enableCount">0</div>
                            <div class="stat-label">Enable Shaping</div>
                        </div>
                        <div class="action-stat warning">
                            <div class="stat-value" id="conditionalCount">0</div>
                            <div class="stat-label">Conditional</div>
                        </div>
                        <div class="action-stat danger">
                            <div class="stat-value" id="upgradeCount">0</div>
                            <div class="stat-label">Upgrade Required</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="twin-footer">
            <p>O-RAN Fronthaul Digital Twin ¬∑ Deterministic Network Simulator ¬∑ Symbol-Level Resolution (35.7 ¬µs)</p>
            <p>This system learns the network, simulates its physics, and proves optimization through replay ‚Äî not
                assumptions.</p>
        </footer>

    </div>

    <!-- Load Digital Twin Engine -->
    <script src="digital_twin.js"></script>
</body>

</html>